# 典型回答

> 这个问题要解决也很简单, 我们已经直到ZipList导致级联问题的原理了, 就是因为entry的preLen, 那怎么办呢?
> 
> 直接删掉就行了吧, 确实, ListPack就是这么做的, 他直接将preLen删掉, 然后用backLen存储占用的字节数, 不同的是这次存储的是自己的字节数, 不会通过别人影响自己的字节数了, 自然也不会发生级联更新问题.

[[✅介绍下Redis中的ZipList和他的级联更新问题]]



上面的文章中，介绍过ZipList的级联更新问题。为了解决这个问题，Redis在5.0中推出了一个新的数据结构，那就是我们要介绍的ListPack了。



我们知道，ZipList之所以会出现级联更新，主要是因为他的Entry中有个prevlen字段，记录的是上一个Entry的长度，并且在长度不同的情况下可能会用1个或者5个字节表示。



那么ListPack为了解决这个问题，其实只要把prevlen干掉就行了，他也正是这么干的， 看下ListPack的结构：



![[535b1d42-7ad3-48fe-8355-84e9ad92af34.png]]



主要改动是Entry这里，废弃了原来的prevlen，而是改用了新的方式，用一个backlen来记录整个Entry的字节数。并且位于元素末尾。他同样采用变成存储，可以用1-5个字节来存储。



就这样，因为ListPack的每个数据项都只会记录自己的长度，而不是再记录上一个节点的长度了，那么，在ListPack中新增或者删除元素，只会影响到这个元素自己，而不需要其他的元素进行级联更新了。也就解决了级联更新的问题了。





