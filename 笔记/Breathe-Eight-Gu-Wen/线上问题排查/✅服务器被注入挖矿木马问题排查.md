我有一台云服务器，用于部署一个我的个人博客的。最近收到告警，说挂了挖矿程序



![[bb1d0340-7470-440d-b3b1-7c7caf7eee66.jpeg]]



首先看下这个程序是不是已经在跑了，top看下运行的进程，发现有一个kswapd0进行耗CPU比较高，这个进程本身是个linux的后台进程，负责内存交换的，但是熟悉的都知道，他其实是个老演员了。

![[b7b37ac4-9445-43df-8f58-9202d4608d79.jpeg]]



正常的kswapd0不会一直在，也不会占CPU这么高，所以怀疑接下来用 netstat -antlp 看看网络连接情况，挖矿不可能没有远程传输吧。



![[c1e04334-ff9a-498e-8e4f-998843fde6c6.jpeg]]



不查不知道，一查就发现了老朋友。通过netstat发现一个瑞士的IP在和kswapd0通信，同时有两个一个罗马尼亚的ip在和rsync这个数据传输进程在不断通信。

![[322f97b6-fa24-48d4-84d8-4ba7002367bc.jpeg]]



接下来就要深挖了，找到这个kswapd0占用的文件路径到底在哪，进入/proc/<pid>这个目录，我这里的<pid>是67498：



![[9e73b65f-39a2-412c-adb1-059a9d80dce6.jpeg]]



最终发现是在git用户在有个文件夹，那这个文件夹就可以直接干掉了。



接下来就是删除文件夹、kill掉进程



检查并清除定时任务，删除被黑的账号，

![[6150ac8d-f511-4c71-9b87-7962adc482e1.jpg]]



![[9aea2b2c-1ced-4b94-835d-4f81d5670f45.jpg]]



清楚这个用户的密钥：

![[b41138cf-8529-4bd8-be19-c9c5ecb76807.jpg]]



![[b6477ac3-1a4a-4e63-9c9a-bf954ddccbce.jpg]]



然后机器就恢复正常了。

![[c0425617-6e7b-4ff7-839d-78e773c101d1.jpg]]

