很多电商都提供商品预约的功能，用户只有预约了才可以进行购买，没有进行预约的不能够进行购买，这个给我最深影响的是当时在京东上购买茅台就必须要预约。



所以在咱们这个电商的购买场景下，我也设计了一个预约的功能，用户需要在开售前进行预约，不预约就无法购买，数字藏品很多也都是热点商品，所以我们开发了一个预约功能。



## 用例图
![[a6c0d0a5-98fb-44ff-8d69-12883817291a.jpeg]]

## ER图
![[4b92ce0f-ef53-48ff-9c10-e111045505be.jpeg]]



goods_book这是一个商品的预约表，记录了一个商品和用户的预约行为，标识一个用户对某个藏品进行了预约。



同时我们在表中添加了三个和预约有关的字段，can_book, book_start_time, book_end_time。

用于记录这个是否能够被预约，还有预约的时间段。



## 系统交互图
![[7bc0e6a2-08d5-420f-9acc-499fd68ede5e.svg]]



在 CollectionVO 中新增了以下三个参数，返回给前端：



```java
/**
 * 预约开始时间
 */
private Date bookStartTime;
﻿
/**
 * 预约结束时间
 */
private Date bookEndTime;
﻿
/**
 * 是否预约
 */
private Integer canBook;
﻿
/**
 * 是否已预约过
 */
private Boolean hasBooked;
```

<font style="color:rgb(38, 38, 38);"></font>

<font style="color:rgb(38, 38, 38);">前端根据这几个字段，判断这个商品是不是需要预约，以及当前时间是否处于可预约时间段内，并且当前用户是否预约过。</font>

<font style="color:rgb(38, 38, 38);"></font>

## <font style="color:rgb(38, 38, 38);">前端展示逻辑（下单按钮）</font>


<font style="color:rgb(38, 38, 38);">售罄：</font>`<font style="color:rgb(38, 38, 38);background-color:rgb(247, 247, 247);">collectionDetail.state == 'SOLD_OUT' || collectionDetail.state == 'NOT_FOR_SALE'"</font>`

<font style="color:rgb(38, 38, 38);">  
</font>

<font style="color:rgb(38, 38, 38);">立即购买：</font>`<font style="color:rgb(38, 38, 38);background-color:rgb(247, 247, 247);">collectionDetail.state == 'SELLING'</font>`

<font style="color:rgb(38, 38, 38);">  
</font>

<font style="color:rgb(38, 38, 38);">预约成功：</font>`<font style="color:rgb(38, 38, 38);background-color:rgb(247, 247, 247);">(collectionDetail.state =='WAIT_FOR_SALE' || collectionDetail.state == 'COMING_SOON') && collectionDetail.hasBooked = true</font>`

<font style="color:rgb(38, 38, 38);">  
</font>

<font style="color:rgb(38, 38, 38);">立即预约：</font>`<font style="color:rgb(38, 38, 38);background-color:rgb(247, 247, 247);">(collectionDetail.state =='WAIT_FOR_SALE' || collectionDetail.state == 'COMING_SOON') && collectionDetail.hasBooked = false && collectionDetail.canBook == 1 && & currentTime >= collectionDetail.bookStartTime && currentTime <= collectionDetail.bookEndTime </font>`

<font style="color:rgb(38, 38, 38);">  
</font>

<font style="color:rgb(38, 38, 38);">即将开售：</font>`<font style="color:rgb(38, 38, 38);background-color:rgb(247, 247, 247);">collectionDetail.state == 'COMING_SOON' && collectionDetail.canBook == 0</font>`

<font style="color:rgb(38, 38, 38);background-color:rgb(247, 247, 247);"></font>

## <font style="color:rgb(38, 38, 38);background-color:rgb(247, 247, 247);">设计亮点</font>

[[基于bitset实现高效的订单预约]]
