- [x] 为什么不在订单的状态为create的时候直接支付, 而是要多走一步流程到confirm才能支付  [completion:: 2025-08-16]

因为我们的下单流程的扣减部分是分成两部分的, 
- 第一部分是靠redis抗大部分的流量, 做一个预扣减, 因为我们不能让大部分流量打到mysql, 触发热点行的更新, 数据库扛不住的.
- 第二部分是将预扣减成功的流量放到mysql中扣减, 这一步其实也有很多说法, 比如基于hint来抗这一部分流量, 或者rocketmq削峰填谷来帮mysql度过难关.

所以说在第一部分我们只是做了一个简单的预扣减, 并没有真正的占用一个库存, 如果第一阶段create成功就可以支付的话, 那么后续数据库库存扣减失败了, 用户付款成功, 就会导致超卖的结果, 这是设计上的不合理, 所以我认为必须要等到他占用了数据库的库存才可以下单, 所以必须要等到confirm阶段才能被用户查看和下单.

后续在压测时候发现通过springEvent来异步转换订单状态的时候, 确实因为流量过大, redis过快, 异步给的mysql压力过大, 导致虽然前几个用户很快, 但是由于流量过大, 使得后面非常慢!!! 这个解决方式就是取消异步, 虽然前几个没有那么快(而且我认为也不需要那么快)