### 你刚才说了有普通交易和秒杀交易, 你现在是如何区分秒杀交易的?

一种是通过特定的活动来报名的人都走秒杀, 比如我们有一个双十一活动, 这样默认走秒杀.

一种是做热点商品检测, 这个在我们项目中是实现了的, 我们会有预约购买商品的接口, 然后通过统计预约商品的人数去判断他到底需不需要走秒杀.(具体是多少人数呢?我们设置的是2000, 为什么是2000呢, 比较复杂了, 基于商品的库存, 我们可以抗的并发和经验值考虑吧,我这里是随便设置的, 按我秒杀方案可以抗的qps, 但是真实的场景下, 我认为要去统计不同商品在秒杀场景下不同预约人数所能达到的qps来设置)

另一种是可以参考京东开源的hotkey来做秒杀商品的检测(如果要详细问我京东的如何实现的, 直接回答没了解过)

### 你说到了统计人数, 你这里是存了一张表来统计的吗, 这样人数的统计不会很慢吗?

不是这样的, 这里我们也做过优化, 我们会去在数据库中存一份预约的人数, 但这只是为了防止数据丢失罢了, 我们其实是将该信息存到了redis中, 然后利用redis的bitset去优化查询, bitset你也可以将他理解成位图吧, 每一位都对应一个用户ID, 如果是第一位就是id为1的用户, 第二位就是id为2的用户, 以此类推...

### 为什么需要用mysql存储呢, 难道redis没有持久化机制吗?

有的兄的, 有的, redis有不同的持久化机制, 包括aof和rdb, 针对不同的场景redis也做了不同的优化, 

[[✅RDB和AOF的写回策略分别是什么？]]

[[✅Redis的持久化机制是怎样的？]]

[[✅Redis能完全保证数据不丢失吗？]]

但是我要说的是, 他不是专门做持久化的, 做了这些优化, 我看过一些文章, 都是会有一些漏洞的, 就像redis同样支持事务, 但是他的事务却不符合ACID的标准. 所以我认为虽然他有持久化机制, 但是我们不能去相信他, 而是要去数据库中做存储, 以一个最简单的例子来说, 我原本是不知道double-write的, 但是当我看完这个机制的时候, 我直接被mysql这强大的设计震撼了, 我才知道原来他考虑的这么全面, 以一点点性能的损耗, 带来的是极大的数据到安全. 对我而言就是专业的事情交给专业的人干吧.

