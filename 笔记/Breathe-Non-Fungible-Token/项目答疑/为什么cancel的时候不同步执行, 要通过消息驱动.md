- [x] 为什么cancel的时候不同步执行, 要通过消息驱动  [completion:: 2025-08-15]

[[引入TCC实现普通交易环节订单和库存的一致性]]

因为在交易系统中, 正向流程肯定要优先保障的. 比如众所周知的双十一无法退款, 这就是一种降级方案来保证正向流程. 把更多的资源留给正向流程.

在我们的TCC方案中, Cancel的发生是一种概率比较低的情况, 在cancel的时候主要是把订单废弃掉, 把库存回滚回去.

尤其是回滚库存, 这个和扣减库存一样, 都是要操作数据库的, 而数据库的并发更新我们需要尽可能的避免, 降低变成热更新的风险. 而且这个操作, 相对来说没那么重要, 完全可以晚一点处理.

所以我们把cancel的操作放到异步链路上, 利用MQ的异步, 解耦等能力, 可以更好的节约资源, 优先保障正向流程.