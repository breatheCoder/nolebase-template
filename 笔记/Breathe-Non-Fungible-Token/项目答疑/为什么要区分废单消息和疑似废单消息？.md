[[引入TCC实现普通交易环节订单和库存的一致性]]

我们在Try的时候，如果失败了，发一个废单消息。在Confirm的时候，如果失败了，就会重试2次，如果还是不成功，则先发一个疑似废单消息。

疑似废单和废单，区别是啥？

废单消息接收到之后，直接执行Cancel。

为什么不直接调cancel，而是要搞个废单消息，主要是一方面这个cancel对实时性要求不高，在资源有限的情况下，尽量的保证主链路，这种分支链路可以放到异步执行。同时呢，基于MQ的重试的机制，也可以避免cancel失败导致卡单的问题。

疑似废单消息，延迟1分钟处理，并且反查订单状态，确认没创建成功后再执行Cancel。

为啥要这么干？其实主要是为了减少Cancel情况的发生，因为在Confirm的时候，有可能因为网络抖动、网络延迟等原因导致处理有所延迟。

有可能我们开始处理Cancel的时候，他已经Confirm了。如果这时候无脑Cancel当然也可以的，但是没必要，因为订单都已经成功了，还Cancel干嘛呢。所以再检查一下，万一这时候已经Confirm了，就不要Cancel了。